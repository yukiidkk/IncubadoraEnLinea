<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorías - Coordinador</title>
    <link rel="stylesheet" href="css/tutorias.css">
</head>

<body>
    <!-- ENCABEZADO -->
    <header class="header">
        <div class="logo">
            <img src="../images/logoITS.png" alt="Logo" class="logo-img">
            <span>Instituto Tecnológico de Saltillo</span>
        </div>
        <nav class="nav">
            <a href="..\inicioC.html">Inicio</a>
            <a href="..\gestionUsuarios.html">Usuarios</a>
            <a href="..\roles.html">Roles</a>
            <a href="..\proyectos.html">Proyectos</a>
            <a href="">Reportes</a>
            <a href="#">Eventos</a>
            <a href="tutorias.html">Tutorias</a>
        </nav>
        <div class="usuario">
            <span>Coordinador</span>
            <img src="../images/user-icon.png" alt="usuario" class="usuario-img" width="25" height="25">
        </div>
    </header>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container">
        <!-- MENÚ LATERAL -->
        <aside class="sidebar">
            <h3>Menú</h3>
            <ul>
                <li><a href="#" class="active">Agenda</a></li>
                <li><a href="disponibilidad.html">Disponibilidad</a></li>
                <li><a href="historial.html">Historial</a></li>
            </ul>
        </aside>

        <!-- CONTENIDO PRINCIPAL -->
        <main class="main">
            <h2>Tutorías</h2>
            <h3>Agenda</h3>
            
            <!-- CONTENEDOR DE CALENDARIO Y FORMULARIO -->
            <div class="content-wrapper">
                <div class="calendario-container">
                    <div class="calendar">
                        <input type="month" id="mes" value="2023-01">
                        <div class="calendar-box">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Dom</th>
                                        <th>Lun</th>
                                        <th>Mar</th>
                                        <th>Mie</th>
                                        <th>Jue</th>
                                        <th>Vie</th>
                                        <th>Sab</th>
                                    </tr>
                                </thead>
                                <tbody id="calendar-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- FORMULARIO -->
                <div class="form-section">
                    <div class="form-group">
                        <label>Nombre del emprendedor</label>
                        <select id="emprendedor">
                            <option value="">Emprendedor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nombre del proyecto</label>
                       <select id="proyecto">
                         <option value="">Proyecto</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fecha de tutoría</label>
                        <div class="row">
                            <select>
                                <option>Día</option>
                            </select>
                            <select>
                                <option>Mes</option>
                            </select>
                            <select>
                                <option>Año</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Seleccionar hora </label>
                        <select>
                            <option>Hora</option>
                        </select>
                    </div>
                    <div class="buttons">
                        <button class="btn registrar">Registrar</button>
                        <button class="btn actualizar">Actualizar</button>
                        <button class="btn eliminar">Eliminar</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const monthInput = document.getElementById("mes");
        const calendarBody = document.getElementById("calendar-body");
        const emprendedorSelect = document.getElementById("emprendedor");
        const proyectoSelect = document.getElementById("proyecto");

        function generarCalendario(year, month) {
            calendarBody.innerHTML = "";
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            let date = 1;

            for (let i = 0; i < 6; i++) {
                const row = document.createElement("tr");
                for (let j = 0; j < 7; j++) {
                    const cell = document.createElement("td");
                    if (i === 0 && j < firstDay) {
                        cell.classList.add("empty");
                        row.appendChild(cell);
                    } else if (date > lastDate) {
                        cell.classList.add("empty");
                        row.appendChild(cell);
                    } else {
                        cell.textContent = date;
                        cell.addEventListener("click", () => seleccionarFecha(cell));
                        row.appendChild(cell);
                        date++;
                    }
                }
                calendarBody.appendChild(row);
            }
        }

        function seleccionarFecha(cell) {
            document.querySelectorAll("td").forEach(td => td.classList.remove("selected"));
            cell.classList.add("selected");
        }

        monthInput.addEventListener("change", () => {
            const [year, month] = monthInput.value.split("-").map(Number);
            generarCalendario(year, month - 1);
        });

        // Inicializar calendario al cargar
        const [initYear, initMonth] = monthInput.value.split("-").map(Number);
        generarCalendario(initYear, initMonth - 1);

//cargar emprendedores
async function cargarEmprendedores() {
    const combo = document.getElementById("emprendedor");
    combo.innerHTML = `<option value="">Seleccione un emprendedor</option>`;

    try {
        const res = await fetch("http://localhost:3001/api/tutorias/emprendedores");
        const data = await res.json();

        data.forEach(e => {
            const op = document.createElement("option");
            op.value = e.id_usuario;       // id del usuario
            op.textContent = e.nombre_completo; // nombre completo
            combo.appendChild(op);
        });
    } catch (err) {
        console.log(err);
    }
}

//Cargar proyectos
emprendedorSelect.addEventListener("change", async () => {
    const id = emprendedorSelect.value;
    proyectoSelect.innerHTML = `<option value="">Proyecto</option>`; // limpiar

    if (!id) return;

    try {
        const res = await fetch(`http://localhost:3001/api/tutorias/proyectos/${id}`);
        const data = await res.json();

        data.forEach(p => {
            const op = document.createElement("option");
            op.value = p.id_proyecto;
            op.textContent = p.nombre_proyecto;
            proyectoSelect.appendChild(op);
        });
    } catch (err) { console.log(err); }
});

// Llamar al cargar la página
cargarEmprendedores();


    </script>
</body>

</html>