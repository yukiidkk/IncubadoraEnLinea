<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro | ITS</title>
    <link rel="shortcut icon" href="./images/logoITS.png" type="image/x-icon">
    <link rel="stylesheet" href="./css/normalize.css">
    <link rel="stylesheet" href="./css/estilos.css">
</head>
<body>

<header class="navbar">
    <div class="container nav-content">
        <div class="logo">
            <img src="./images/logoITS.png" alt="ITS" />
            <span>Instituto Tecnol√≥gico de Saltillo</span>
        </div>
    </div>
</header>

<div class="main-content">
    <div class="form-container">
        <header>
            <h2>Crea una cuenta</h2>
            <p>Llena los siguientes campos seg√∫n corresponda:</p>
        </header>
        
        <form class="account-form">
            <div class="columns-wrapper">
                
                <div class="column">
                    <div class="form-group">
                        <label for="nombre">Nombre(s):</label>
                        <input type="text" id="nombre" name="nombre" placeholder="Ingrese su nombre(s)" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="apellidos">Apellidos:</label>
                        <input type="text" id="apellidos" name="apellidos" placeholder="Ingresa tus apellidos" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="telefono">N√∫mero de tel√©fono:</label>
                        <input type="tel" id="telefono" name="telefono" placeholder="Ingrese su n√∫mero de tel√©fono" required>
                    </div>

                    <div class="form-group">
                        <label>Ingrese su fecha de nacimiento</label>
                        <div class="date-group">
                            <select name="dia" id="dia" required>
                                <option value="">D√≠a</option>
                            </select>
                            <select name="mes" id="mes" required>
                                <option value="">Mes</option>
                            </select>
                            <select name="anio" id="anio" required>
                                <option value="">A√±o</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="email">Correo electr√≥nico</label>
                        <input type="email" id="email" name="email" placeholder="Ingrese su correo electr√≥nico" required>
                    </div>

                    <div class="form-group">
                        <label for="ingresos">Ingresos:</label>
                        <input type="number" id="ingresos" name="ingresos" placeholder="Ingrese su ingreso mensual" required>
                    </div>

                    <div class="form-group">
                        <label for="dependientes">Dependientes econ√≥micos</label>
                        <select id="dependientes" name="dependientes" required>
                            <option value="">Seleccione la cantidad de dependientes</option>
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10+</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="password">Ingrese su contrase√±a</label>
                        <input type="password" id="password" name="password" placeholder="Ingrese su contrase√±a" required>
                    </div>
                </div>

                <div class="column">
                    <div class="form-group">
                        <label for="rfc">RFC:</label>
                        <input type="text" id="rfc" name="rfc" placeholder="Ingrese su RFC" required>
                    </div>

                    <div class="form-group">
                        <label for="curp">CURP:</label>
                        <input type="text" id="curp" name="curp" placeholder="Ingrese su CURP" required>
                    </div>

                    <div class="form-group">
                        <label>Estado civil y G√©nero:</label>
                        <div class="inline-group">
                            <select name="estado_civil" required>
                                <option value="">Seleccione su estado civil</option>
                                <option value="Soltero">Soltero</option>
                                <option value="Casado">Casado</option>
                                <option value="Divorciado">Divorciado</option>
                                <option value="Viudo">Viudo</option>
                            </select>
                            <select name="genero" required>
                                <option value="">Seleccione su g√©nero</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Femenino">Femenino</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Domicilio</label>
                        <div class="inline-group">
                            <input type="text" name="colonia" placeholder="Colonia" required>
                            <input type="text" name="cp" placeholder="C.P." required>
                        </div>
                        <input type="text" name="calle" placeholder="Calle" required>
                    </div>

                    <div class="form-group">
                        <label for="jornada">Jornada laboral</label>
                        <select id="jornada" name="jornada">
                            <option value="">(Sin jornada laboral)</option>
                            <option value="Completa">Completa</option>
                            <option value="Media">Media</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="control-number">N√∫mero de control</label>
                        <input type="text" id="control-number" name="control_number" placeholder="Ingrese su n√∫mero de control" required>
                    </div>

                    <div class="form-group">
                        <label for="especialidad">Seleccione su especialidad</label>
                        <select id="especialidad" name="especialidad" required>
                            <option value="">Seleccione su especialidad</option>
                            <option value="1">Sistemas Computacionales</option>
                            <option value="2">Administraci√≥n</option>
                            <option value="3">Electr√≥nica</option>
                            <option value="4">Industrial</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-group button-center">
                <button type="submit" class="btn-primary-its">Crear cuenta</button>
            </div>
        </form>
    </div>
</div>

<!-- üîΩ Script para llenar selects y enviar datos -->
<script>
// === Llenar selects de fecha ===
const diaSelect = document.getElementById("dia");
const mesSelect = document.getElementById("mes");
const anioSelect = document.getElementById("anio");

// D√≠as 1-31
for (let d = 1; d <= 31; d++) {
  const opt = document.createElement("option");
  opt.value = d.toString().padStart(2, "0");
  opt.textContent = d;
  diaSelect.appendChild(opt);
}

// Meses 1-12 con nombre
const meses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
meses.forEach((m, i) => {
  const opt = document.createElement("option");
  opt.value = (i + 1).toString().padStart(2, "0");
  opt.textContent = m;
  mesSelect.appendChild(opt);
});

// A√±os desde actual hasta 1950
const anioActual = new Date().getFullYear();
for (let y = anioActual; y >= 1950; y--) {
  const opt = document.createElement("option");
  opt.value = y;
  opt.textContent = y;
  anioSelect.appendChild(opt);
}

// === Enviar datos al backend ===
document.querySelector(".account-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const data = {
    nombre: document.querySelector("#nombre").value,
    apellido: document.querySelector("#apellidos").value,
    correo: document.querySelector("#email").value,
    password: document.querySelector("#password").value,
    telefono: document.querySelector("#telefono").value,
    fecha_nacimiento: `${anioSelect.value}-${mesSelect.value}-${diaSelect.value}`,
    ingresos: document.querySelector("#ingresos").value,
    dependientes: document.querySelector("#dependientes").value,
    rfc: document.querySelector("#rfc").value,
    curp: document.querySelector("#curp").value,
    estado_civil: document.querySelector('select[name="estado_civil"]').value,
    genero: document.querySelector('select[name="genero"]').value,
    colonia: document.querySelector('input[name="colonia"]').value,
    cp: document.querySelector('input[name="cp"]').value,
    calle: document.querySelector('input[name="calle"]').value,
    jornada: document.querySelector("#jornada").value,
    no_control: document.querySelector("#control-number").value,
    especialidad: document.querySelector("#especialidad").value
  };

  try {
    const response = await fetch("http://localhost:3001/api/registro", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const result = await response.json();
    if (result.success) {
      alert("Registro exitoso. Ser√°s redirigido al inicio de sesi√≥n.");
      e.target.reset();

      // Esperar 1.5 segundos antes de redirigir
      setTimeout(() => {
        window.location.href = "login.html";
      }, 1500);
    } else {
      alert("Error: " + result.message);
    }
  } catch (err) {
    console.error("Error al registrar:", err);
    alert("Error al conectar con el servidor.");
  }
});
</script>


</body>
</html>
