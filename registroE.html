<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro | ITS</title>
  <link rel="shortcut icon" href="./images/logoITS.png" type="image/x-icon">
  <link rel="stylesheet" href="./css/normalize.css">
  <link rel="stylesheet" href="./css/estilos.css">
</head>
<body>

<header class="navbar">
  <div class="container nav-content">
    <div class="logo">
      <img src="./images/logoITS.png" alt="ITS" />
      <span>Instituto Tecnológico de Saltillo</span>
    </div>
  </div>
</header>

<div class="main-content">
  <div class="form-container">
    <header>
      <h2>Crea una cuenta</h2>
      <p>Llena los siguientes campos según corresponda:</p>
    </header>
    
    <form class="account-form" autocomplete="off">
      <div class="columns-wrapper">
        
        <!-- COLUMNA 1 -->
        <div class="column">
          <div class="form-group">
            <label for="nombre">Nombre(s):</label>
            <input type="text" id="nombre" name="nombre" placeholder="Ingrese su nombre(s)"
                   maxlength="50" required
                   oninput="this.value = this.value.replace(/[^A-Za-zÁÉÍÓÚáéíóúÑñ\s]/g,'')">
          </div>
          
          <div class="form-group">
            <label for="apellidos">Apellidos:</label>
            <input type="text" id="apellidos" name="apellidos" placeholder="Ingresa tus apellidos"
                   maxlength="50" required
                   oninput="this.value = this.value.replace(/[^A-Za-zÁÉÍÓÚáéíóúÑñ\s]/g,'')">
          </div>
          
          <div class="form-group">
            <label for="telefono">Número de teléfono:</label>
            <input type="tel" id="telefono" name="telefono" placeholder="Ingrese su número de teléfono"
                   maxlength="10" minlength="10" required
                   oninput="this.value = this.value.replace(/[^0-9]/g,'')">
          </div>

          <div class="form-group">
            <label>Ingrese su fecha de nacimiento</label>
            <div class="date-group">
              <select name="dia" id="dia" required>
                <option value="">Día</option>
              </select>
              <select name="mes" id="mes" required>
                <option value="">Mes</option>
              </select>
              <select name="anio" id="anio" required>
                <option value="">Año</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="email">Correo electrónico</label>
            <input type="email" id="email" name="email" placeholder="Ingrese su correo electrónico"
                   maxlength="100" required>
          </div>

          <div class="form-group">
            <label for="ingresos">Ingresos:</label>
            <input type="number" id="ingresos" name="ingresos" placeholder="Ingrese su ingreso mensual"
                   min="0" max="1000000" required>
          </div>

          <div class="form-group">
            <label for="dependientes">Dependientes económicos</label>
            <select id="dependientes" name="dependientes" required>
              <option value="">Seleccione la cantidad de dependientes</option>
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10+</option>
            </select>
          </div>

          <div class="form-group">
            <label for="password">Ingrese su contraseña</label>
            <input type="password" id="password" name="password" placeholder="Ingrese su contraseña"
                   minlength="6" maxlength="20" required>
          </div>
        </div>

        <!-- COLUMNA 2 -->
        <div class="column">
          <div class="form-group">
            <label for="rfc">RFC:</label>
            <input type="text" id="rfc" name="rfc" placeholder="Ingrese su RFC"
                   maxlength="13" minlength="12" required
                   oninput="this.value = this.value.toUpperCase().replace(/[^A-Z0-9Ñ&]/g,'')">
          </div>

          <div class="form-group">
            <label for="curp">CURP:</label>
            <input type="text" id="curp" name="curp" placeholder="Ingrese su CURP"
                   maxlength="18" minlength="18" required
                   oninput="this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g,'')">
          </div>

          <div class="form-group">
            <label>Estado civil y Género:</label>
            <div class="inline-group">
              <select name="estado_civil" required>
                <option value="">Seleccione su estado civil</option>
                <option value="Soltero">Soltero</option>
                <option value="Casado">Casado</option>
                <option value="Divorciado">Divorciado</option>
                <option value="Viudo">Viudo</option>
              </select>
              <select name="genero" required>
                <option value="">Seleccione su género</option>
                <option value="Masculino">Masculino</option>
                <option value="Femenino">Femenino</option>
                <option value="Otro">Otro</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Domicilio</label>
            <div class="inline-group">
              <input type="text" name="colonia" placeholder="Colonia"
                     maxlength="50" required
                     oninput="this.value = this.value.replace(/[^A-Za-zÁÉÍÓÚáéíóúÑñ\s]/g,'')">
              <input type="text" name="cp" placeholder="C.P."
                     maxlength="5" minlength="5" required
                     oninput="this.value = this.value.replace(/[^0-9]/g,'')">
            </div>
            <input type="text" name="calle" placeholder="Calle"
                   maxlength="100" required
                   oninput="this.value = this.value.replace(/[^A-Za-zÁÉÍÓÚáéíóúÑñ0-9\s#\.]/g,'')">
          </div>

          <div class="form-group">
            <label for="jornada">Jornada laboral</label>
            <select id="jornada" name="jornada">
              <option value="">(Sin jornada laboral)</option>
              <option value="Completa">Completa</option>
              <option value="Media">Media</option>
            </select>
          </div>

          <div class="form-group">
            <label for="control-number">Número de control</label>
            <input type="text" id="control-number" name="control_number"
                   maxlength="10" minlength="8" placeholder="Ingrese su número de control"
                   required oninput="this.value = this.value.replace(/[^0-9]/g,'')">
          </div>

          <div class="form-group">
            <label for="especialidad">Seleccione su especialidad</label>
            <select id="especialidad" name="especialidad" required>
              <option value="">Seleccione su especialidad</option>
              <option value="1">Sistemas Computacionales</option>
              <option value="2">Administración</option>
              <option value="3">Electrónica</option>
              <option value="4">Industrial</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-group button-center">
        <button type="submit" class="btn-primary-its">Crear cuenta</button>
      </div>
    </form>
  </div>
</div>

<!-- Script para selects y envío -->
<script>
// === Llenar selects de fecha ===
const diaSelect = document.getElementById("dia");
const mesSelect = document.getElementById("mes");
const anioSelect = document.getElementById("anio");

for (let d = 1; d <= 31; d++) {
  diaSelect.innerHTML += `<option value="${String(d).padStart(2,'0')}">${d}</option>`;
}

const meses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
meses.forEach((m, i) => {
  mesSelect.innerHTML += `<option value="${String(i+1).padStart(2,'0')}">${m}</option>`;
});

const anioActual = new Date().getFullYear();
for (let y = anioActual; y >= 1950; y--) {
  anioSelect.innerHTML += `<option value="${y}">${y}</option>`;
}

// === Enviar datos ===
document.querySelector(".account-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const data = {
    nombre: document.querySelector("#nombre").value.trim(),
    apellido: document.querySelector("#apellidos").value.trim(),
    correo: document.querySelector("#email").value.trim(),
    password: document.querySelector("#password").value.trim(),
    telefono: document.querySelector("#telefono").value.trim(),
    fecha_nacimiento: `${anioSelect.value}-${mesSelect.value}-${diaSelect.value}`,
    ingresos: document.querySelector("#ingresos").value,
    dependientes: document.querySelector("#dependientes").value,
    rfc: document.querySelector("#rfc").value.trim(),
    curp: document.querySelector("#curp").value.trim(),
    estado_civil: document.querySelector('select[name="estado_civil"]').value,
    genero: document.querySelector('select[name="genero"]').value,
    colonia: document.querySelector('input[name="colonia"]').value.trim(),
    cp: document.querySelector('input[name="cp"]').value.trim(),
    calle: document.querySelector('input[name="calle"]').value.trim(),
    jornada: document.querySelector("#jornada").value,
    no_control: document.querySelector("#control-number").value.trim(),
    especialidad: document.querySelector("#especialidad").value
  };

  try {
    const response = await fetch("http://localhost:3001/api/registro", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const result = await response.json();
    if (result.success) {
      alert("Registro exitoso. Serás redirigido al inicio de sesión.");
      e.target.reset();
      setTimeout(() => window.location.href = "login.html", 1500);
    } else {
      alert("Error: " + result.message);
    }
  } catch (err) {
    console.error("Error al registrar:", err);
    alert("Error al conectar con el servidor.");
  }
});
</script>

</body>
</html>
