<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mis Proyectos ‚Äî Centro de Emprendurismo ITS</title>
  <link rel="shortcut icon" href="images/logoITS.png" type="image/x-icon">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/estilos.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --primary: #002f6c;
      --primary-light: #4a82e2;
      --secondary: #f8fafc;
      --accent: #48bb78;
      --accent-light: #9ae6b4;
      --warning: #ed8936;
      --text: #2d3748;
      --text-light: #718096;
      --border: #e2e8f0;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      --shadow-hover: 0 8px 15px rgba(0, 0, 0, 0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      color: var(--text);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      min-height: 100vh;
    }

    /* ===== NAVBAR ===== */
    .navbar {
      background: linear-gradient(135deg, var(--primary) 0%, #001f47 100%);
      color: white;
      padding: 15px 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .nav-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo img {
      height: 40px;
    }

    .logo span {
      font-weight: 600;
      font-size: 18px;
    }

    .nav-links {
      display: flex;
      gap: 25px;
    }

    .nav-links a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    .nav-links a:hover {
      background-color: rgba(255, 255, 255, 0.15);
    }

    .nav-links a.active {
      background-color: rgba(255, 255, 255, 0.2);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-text {
      font-weight: 500;
    }

    .user-icon {
      background-color: var(--accent);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* ===== CONTENEDOR PRINCIPAL ===== */
    .main-container {
      display: flex;
      max-width: 1200px;
      margin: 30px auto;
      gap: 25px;
      padding: 0 20px;
    }

    /* ===== SIDEBAR MEJORADO ===== */
    .sidebar {
      width: 260px;
      background: white;
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 25px 0;
      flex-shrink: 0;
    }

    .sidebar h2 {
      color: var(--primary);
      padding: 0 20px 15px;
      margin-bottom: 15px;
      border-bottom: 2px solid var(--border);
      font-size: 18px;
      font-weight: 700;
    }

    .sidebar a {
      display: block;
      padding: 12px 20px;
      color: var(--text);
      text-decoration: none;
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
      font-weight: 500;
    }

    .sidebar a:hover {
      background-color: #f7fafc;
      color: var(--primary);
      border-left-color: var(--primary-light);
    }

    .sidebar a.active {
      background-color: #edf2f7;
      color: var(--primary);
      border-left-color: var(--primary);
      font-weight: 600;
    }

    /* ===== CONTENIDO PRINCIPAL ===== */
    .content {
      flex: 1;
      background: white;
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 30px;
      transition: all 0.3s ease;
    }

    .content:hover {
      box-shadow: var(--shadow-hover);
    }

    .header-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }

    .header-section h1 {
      color: var(--primary);
      font-size: 28px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* ===== B√öSQUEDA ===== */
    .search-container {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 25px;
      background: var(--secondary);
      padding: 20px;
      border-radius: 12px;
      box-shadow: var(--shadow);
    }

    .search-input {
      flex: 1;
      position: relative;
    }

    .search-input input {
      width: 100%;
      padding: 14px 20px 14px 45px;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-size: 15px;
      transition: all 0.3s ease;
      background: white url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="%23718096" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>') no-repeat 15px center;
    }

    .search-input input:focus {
      outline: none;
      border-color: var(--primary-light);
      box-shadow: 0 0 0 3px rgba(74, 130, 226, 0.1);
    }

    /* ===== BOTONES ===== */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
      color: white;
      box-shadow: 0 2px 5px rgba(74, 130, 226, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(74, 130, 226, 0.4);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--accent) 0%, #2f855a 100%);
      color: white;
      box-shadow: 0 2px 5px rgba(72, 187, 120, 0.3);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(72, 187, 120, 0.4);
    }

    .btn-secondary {
      background: white;
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: #f7fafc;
      border-color: var(--primary-light);
    }

    /* ===== LISTA DE PROYECTOS ===== */
    .proyectos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .proyecto-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .proyecto-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
      border-color: var(--primary-light);
    }

    .proyecto-card.active {
      border-color: var(--accent);
      background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%);
    }

    .proyecto-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .proyecto-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary);
      margin: 0;
    }

    .proyecto-status {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-activo {
      background: var(--accent-light);
      color: #22543d;
    }

    .status-pendiente {
      background: #fed7d7;
      color: #742a2a;
    }

    .status-finalizado {
      background: #c6f6d5;
      color: #22543d;
    }

    .proyecto-info {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 15px;
    }

    .proyecto-info-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-light);
    }

    .progreso-bar {
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progreso-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-light), var(--primary));
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .progreso-text {
      font-size: 12px;
      font-weight: 600;
      color: var(--primary);
      text-align: right;
    }

    /* ===== DETALLE DEL PROYECTO ===== */
    .detalle-proyecto {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: var(--shadow);
      margin-top: 30px;
      border: 1px solid var(--border);
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .detalle-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }

    .detalle-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
      margin: 0;
    }

    .detalle-actions {
      display: flex;
      gap: 10px;
    }

    .detalle-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
    }

    .detalle-info {
      background: var(--secondary);
      padding: 20px;
      border-radius: 10px;
    }

    .info-item {
      margin-bottom: 15px;
    }

    .info-label {
      font-size: 12px;
      color: var(--text-light);
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 16px;
      color: var(--text);
      font-weight: 500;
    }

    /* ===== FORMULARIO DE HITOS ===== */
    .form-section {
      background: var(--secondary);
      padding: 25px;
      border-radius: 12px;
      margin: 25px 0;
    }

    .form-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text);
    }

    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.3s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-light);
      box-shadow: 0 0 0 3px rgba(74, 130, 226, 0.1);
    }

    textarea.form-control {
      min-height: 100px;
      resize: vertical;
    }

    /* ===== LISTA DE HITOS ===== */
    .hitos-list {
      margin-top: 25px;
    }

    .hitos-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .hito-item {
      background: white;
      border-left: 4px solid var(--primary-light);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
    }

    .hito-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .hito-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }

    .hito-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--primary);
      margin: 0;
    }

    .hito-date {
      font-size: 12px;
      color: var(--text-light);
      white-space: nowrap;
    }

    .hito-content {
      color: var(--text);
      font-size: 14px;
      line-height: 1.5;
      margin: 10px 0;
    }

    /* ===== MENSAJES ===== */
    .mensaje-info {
      text-align: center;
      background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
      color: #234e52;
      padding: 40px 30px;
      border-radius: 12px;
      margin: 40px auto;
      width: 100%;
      font-weight: 500;
      box-shadow: var(--shadow);
      border: 1px solid #81e6d9;
    }

    .mensaje-error {
      text-align: center;
      background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
      color: #742a2a;
      padding: 30px;
      border-radius: 12px;
      margin: 30px auto;
      width: 100%;
      font-weight: 500;
      box-shadow: var(--shadow);
      border: 1px solid #fc8181;
    }

    .empty-state {
      text-align: center;
      padding: 50px 30px;
      background: var(--secondary);
      border-radius: 12px;
      margin: 20px 0;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 15px;
      color: var(--text-light);
    }

    .empty-state h3 {
      color: var(--text);
      margin-bottom: 10px;
      font-size: 20px;
    }

    .empty-state p {
      color: var(--text-light);
      max-width: 400px;
      margin: 0 auto;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1024px) {
      .main-container {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
      }
      
      .detalle-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .header-section {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .search-container {
        flex-direction: column;
      }
      
      .proyectos-grid {
        grid-template-columns: 1fr;
      }
      
      .detalle-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .detalle-actions {
        width: 100%;
        justify-content: flex-start;
      }
    }
  </style>
</head>

<body>
  <!-- ===== NAVBAR SUPERIOR ===== -->
  <header class="navbar">
    <div class="container nav-content">
      <div class="logo">
        <img src="images/logoITS.png" alt="ITS" />
        <span>Instituto Tecnol√≥gico de Saltillo</span>
      </div>
      <nav class="nav-links">
        <a href="inicioE.html" id="btnHome">Home</a>
        <a href="proyectos.html" id="btnProyectos">Proyectos</a>
        <a href="avancesMiProyecto.html" class="active">Mis Proyectos</a>
      </nav>
      <div class="user-info">
        <span class="user-text">Emprendedor</span>
        <div class="user-icon">üë§</div>
      </div>
    </div>
  </header>

  <div class="main-container">
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
      <h2>Mis Proyectos</h2>
      <a href="avancesMiProyecto.html" class="active">üìä Avances de Mi Proyecto</a>
      <a href="misReportesE.html">üìà Mis Reportes</a>
      <a href="comentariosE.html">üí¨ Comentarios</a>
    </aside>

    <!-- ===== CONTENIDO PRINCIPAL ===== -->
    <section class="content">
      <div class="header-section">
        <h1>üìà Mis Proyectos y Avances</h1>
        <div class="search-container">
          <div class="search-input">
            <input type="text" id="inputBusqueda" placeholder="Buscar entre tus proyectos...">
          </div>
          <button class="btn btn-primary" id="btnBuscar">üîç Buscar</button>
        </div>
      </div>

      <div id="contenedor">
        <div class="mensaje-info">
          <div style="font-size: 24px; margin-bottom: 10px;">üëã ¬°Bienvenido!</div>
          <p>Carga tus proyectos o selecciona uno para ver sus avances y agregar nuevos hitos.</p>
        </div>
      </div>
    </section>
  </div>

  <script>
    const id_usuario = localStorage.getItem("id_usuario");

    const API_BASE = "http://localhost:3001/api/reportes/proyectos";

    const contenedor = document.getElementById('contenedor');
    const inputBusqueda = document.getElementById('inputBusqueda');
    const btnBuscar = document.getElementById('btnBuscar');

    let proyectosUsuario = [];
    let proyectoSeleccionado = null;

      ;

   

    // -------------------- INICIO --------------------
    async function init() {
        try {
            mostrarCargando("Cargando tus proyectos...");

            const res = await fetch(`${API_BASE}/usuario/${id_usuario}`);
            const json = await res.json();

          //const proyectos = await getProyectosDeUsuario();
            //const aprobados = proyectos.filter(p => p.estado === "aprobado")
            //setProyectos(aprobados);
            if (!json.success || !json.data || json.data.length === 0) {
                mostrarMensajeSinProyectos();
                return;
            }

            proyectosUsuario = json.data;
            mostrarListaProyectos(proyectosUsuario);

        } catch (err) {
            console.error(err);
            mostrarMensaje("‚ùå Error de conexi√≥n con el servidor", "error");
        }
    }



    // -------------------- LISTA DE PROYECTOS --------------------
    function mostrarListaProyectos(lista) {
        if (!lista || lista.length === 0) {
            mostrarMensajeSinProyectos();
            return;
        }

        contenedor.innerHTML = `
            <h2 style="color: var(--primary); margin-bottom: 20px;">Mis Proyectos (${lista.length})</h2>
            <div class="proyectos-grid" id="listaProyectos">
                ${lista.map((p, index) => crearTarjetaProyecto(p, index)).join("")}
            </div>
            <div id="detalleProyecto" style="display: none;"></div>
        `;

        document.querySelectorAll(".btn-ver-detalle").forEach(btn => {
  btn.addEventListener("click", (e) => {
    e.stopPropagation(); // evita que dispare el click de la tarjeta
    const id = btn.dataset.id;
    seleccionarProyecto(id);
  });
});


        // Agregar event listeners a las tarjetas
        lista.forEach((p, index) => {
            const card = document.querySelector(`#proyecto-${index}`);
            if (card) {
                card.addEventListener('click', () => seleccionarProyecto(p.id_proyecto));
            }
        });
    }

    function crearTarjetaProyecto(proyecto, index) {
        const statusClass = getStatusClass(proyecto.estatus);
        const progressWidth = parseInt(proyecto.progreso) || 0;
        
        return `
            <div class="proyecto-card" id="proyecto-${index}">
                <div class="proyecto-header">
                    <h3 class="proyecto-title">${proyecto.nombre_proyecto}</h3>
                    <span class="proyecto-status ${statusClass}">${proyecto.estatus || 'Sin estado'}</span>
                </div>
                
                <div class="proyecto-info">
                    <div class="proyecto-info-item">
                        üìÖ <span>Inicio: ${new Date(proyecto.fecha_inicio).toLocaleDateString()}</span>
                    </div>
                    <div class="proyecto-info-item">
                        üìù <span>${proyecto.descripcion?.substring(0, 60) || 'Sin descripci√≥n'}...</span>
                    </div>
                </div>
                
                <div class="progreso-bar">
                    <div class="progreso-fill" style="width: ${progressWidth}%"></div>
                </div>
                <div class="progreso-text">Progreso: ${progressWidth}%</div>
                
                <button 
                    class="btn btn-primary btn-ver-detalle"
                    data-id="${proyecto.id_proyecto}"
                    style="width: 100%; margin-top: 15px;">
                 Ver Detalles
                </button>
            </div>
        `;
    }

    function getStatusClass(estatus) {
        const statusLower = (estatus || '').toLowerCase();
        if (statusLower.includes('curso') || statusLower.includes('activo')) return 'status-activo';
        if (statusLower.includes('finalizado') || statusLower.includes('completado')) return 'status-finalizado';
        return 'status-pendiente';
    }

    // -------------------- SELECCIONAR PROYECTO --------------------
    async function seleccionarProyecto(id_proyecto) {
       mostrarCargando("Cargando informaci√≥n del proyecto...");
        console.log("üëâ ID RECIBIDO EN seleccionarProyecto:", id_proyecto, typeof id_proyecto);
        try {
            const resProyecto = await fetch(`${API_BASE}/${id_proyecto}`);
           // const resAvances = await fetch(`${API_BASE}/emprendedor/proyectos/${id_proyecto}/avances`);
             
            const resAvances = await fetch(
             `http://localhost:3001/api/reportes/emprendedor/proyectos/${id_proyecto}/avances`
            );

            const pj = await resProyecto.json();
            const av = await resAvances.json();
          
             console.log("RESP PROYECTO ===>", pj);
            console.log("RESP AVANCES ===>", av);

            if (!pj.success || !pj.data) {
                throw new Error("Proyecto no v√°lido");
            }

            proyectoSeleccionado = pj.data;
            proyectoSeleccionado.avances = av.success ? av.data : [];
            
            console.log("PROYECTO SELECCIONADO ===>", proyectoSeleccionado);

             
            mostrarDetalleProyecto(proyectoSeleccionado);

        } catch (e) {
            console.error("ERROR REAL ===>",e);
            mostrarMensaje("Error al cargar los datos del proyecto", "error");
        }
    }

    // -------------------- DETALLE DEL PROYECTO --------------------
    function mostrarDetalleProyecto(proyecto) {
        const statusClass = getStatusClass(proyecto.estatus);
        const progressWidth = parseInt(proyecto.progreso) || 0;
        
        contenedor.innerHTML = `
            <div class="detalle-proyecto">
                <div class="detalle-header">
                    <h2 class="detalle-title">${proyecto.nombre_proyecto}</h2>
                    <div class="detalle-actions">
                        <button class="btn btn-secondary" onclick="volverALista()">‚Üê Volver</button>
                        <button class="btn btn-success" onclick="descargarExcel()">üìÑ Descargar Excel</button>
                    </div>
                </div>
                
                <div class="detalle-grid">
                    <div>
                        <div class="detalle-info">
                            <div class="info-item">
                                <div class="info-label">Descripci√≥n</div>
                                <div class="info-value">${proyecto.descripcion || 'Sin descripci√≥n'}</div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="info-item">
                                    <div class="info-label">Estado</div>
                                    <div class="info-value"><span class="proyecto-status ${statusClass}">${proyecto.estatus || 'Sin estado'}</span></div>
                                </div>
                                
                                <div class="info-item">
                                    <div class="info-label">Progreso</div>
                                    <div class="info-value">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <div style="flex: 1;">
                                                <div class="progreso-bar">
                                                    <div class="progreso-fill" style="width: ${progressWidth}%"></div>
                                                </div>
                                            </div>
                                            <div style="font-weight: bold;">${progressWidth}%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="info-item">
                                    <div class="info-label">Fecha de Inicio</div>
                                    <div class="info-value">${new Date(proyecto.fecha_inicio).toLocaleDateString()}</div>
                                </div>
                                
                                
                            </div>
                        </div>
                        
                        <!-- Formulario para agregar hito -->
                        <div class="form-section">
                            <h3 class="form-title">‚ûï Agregar Nuevo Hito</h3>
                            <div class="form-group">
                                <label for="inputHito">T√≠tulo del Hito</label>
                                <input type="text" id="inputHito" class="form-control" placeholder="Ej: Completado prototipo inicial">
                            </div>
                            <div class="form-group">
                                <label for="inputNotas">Descripci√≥n</label>
                                <textarea id="inputNotas" class="form-control" placeholder="Describe los detalles de este hito..."></textarea>
                            </div>
                            <button class="btn btn-success" onclick="guardarHito()">
                                üíæ Guardar Hito
                            </button>
                        </div>
                        
                        <!-- Lista de hitos -->
                        <div class="hitos-list">
                            <h3 class="hitos-title">üìã Historial de Hitos</h3>
                            ${generarListaHitosHTML(proyecto.avances)}
                        </div>
                    </div>
                    
                    <!-- Formulario de comentarios -->
                    <div>
                        <div class="form-section">
                            <h3 class="form-title">üí¨ Enviar Comentario al Coordinador</h3>
                            <div class="form-group">
                                <label for="inputComentario">Tu Comentario</label>
                                <textarea id="inputComentario" class="form-control" placeholder="Escribe tu pregunta, comentario o solicitud aqu√≠..."></textarea>
                            </div>
                            <button class="btn btn-primary" onclick="enviarComentario()">
                                ‚úâÔ∏è Enviar Comentario
                            </button>
                            <p style="font-size: 12px; color: var(--text-light); margin-top: 10px;">
                                Tu comentario ser√° enviado al coordinador asignado.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function volverALista() {
        mostrarListaProyectos(proyectosUsuario);
    }

    // -------------------- LISTA DE HITOS --------------------
    function generarListaHitosHTML(avances) {
        if (!avances || avances.length === 0) {
            return `
                <div class="empty-state">
                    <div class="empty-state-icon">üìù</div>
                    <h3>No hay hitos registrados</h3>
                    <p>Agrega tu primer hito para comenzar a documentar los avances de tu proyecto.</p>
                </div>
            `;
        }

          return avances.map(a => `
             <div class="hito-item">
            <div class="hito-header">
              <strong>${a.hitos}</strong>
               <span>${new Date(a.fecha_creacion).toLocaleDateString()}</span>
            </div>
           <p>${a.notas}</p>
          <small>Por: ${a.nombre} ${a.apellido}</small>
             </div>
  `).join("");
    }

    // -------------------- GUARDAR HITO --------------------
    async function guardarHito() {
        const hitos = document.getElementById("inputHito")?.value.trim();
        const notas = document.getElementById("inputNotas")?.value.trim();
        const id_usuario = localStorage.getItem("id_usuario");

        if (!hitos) {
            alert("‚ö†Ô∏è Por favor, escribe un t√≠tulo para el hito.");
            return;
        }

        if (!proyectoSeleccionado) {
            alert("‚ö†Ô∏è No hay proyecto seleccionado.");
            return;
        }

        try {
            const res =await fetch ( `http://localhost:3001/api/reportes/proyectos/${proyectoSeleccionado.id_proyecto}/avances`,
             {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ hitos, notas , id_usuario}),
            });

            const json = await res.json();

            if (!json.success) {
                alert("‚ùå Error al guardar el hito.");
                return;
            }

            alert("‚úÖ Hito guardado exitosamente.");
            seleccionarProyecto(proyectoSeleccionado.id_proyecto);

        } catch (error) {
            console.error(error);
            alert("‚ùå Error de conexi√≥n al guardar el hito.");
        }
    }

    // -------------------- ENVIAR COMENTARIO --------------------
    async function enviarComentario() {
        const comentario = document.getElementById("inputComentario")?.value.trim();
        const id_usuario = localStorage.getItem("id_usuario");

        if (!comentario) {
            alert("‚ö†Ô∏è Por favor, escribe un comentario.");
            return;
        }

        if (!proyectoSeleccionado) {
            alert("‚ö†Ô∏è No hay proyecto seleccionado.");
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/${proyectoSeleccionado.id_proyecto}/comentarios`, {
                        
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ 
                    id_proyecto: proyectoSeleccionado.id_proyecto,
                    comentario, 
                    id_usuario_emisor: id_usuario 
                }),
            });

            const json = await res.json();

            if (!json.success) {
                alert("‚ùå Error al enviar el comentario.");
                return;
            }

            alert("‚úÖ Comentario enviado exitosamente.");
            document.getElementById("inputComentario").value = "";

        } catch (error) {
            console.error(error);
            alert("‚ùå Error de conexi√≥n al enviar el comentario.");
        }
    }

    // -------------------- EXCEL --------------------
    function descargarExcel() {
        if (!proyectoSeleccionado) {
            alert("‚ö†Ô∏è No hay proyecto seleccionado.");
            return;
        }
        window.open(`${API_BASE}/${proyectoSeleccionado.id_proyecto}/excel`);
    }

    // -------------------- B√öSQUEDA --------------------
    btnBuscar.addEventListener("click", buscarProyecto);
    inputBusqueda.addEventListener("keypress", (e) => e.key === "Enter" && buscarProyecto());

    async function buscarProyecto() {
        const nombre = inputBusqueda.value.trim();
        if (!nombre) {
            mostrarListaProyectos(proyectosUsuario);
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/buscar/${nombre}?id_usuario=${id_usuario}`);
            const json = await res.json();

            if (!json.success) {
                mostrarMensaje("üîç No se encontraron proyectos con ese nombre", "info");
                return;
            }

            mostrarListaProyectos(json.data);

        } catch (error) {
            console.error(error);
            mostrarMensaje("‚ùå Error al buscar proyectos", "error");
        }
    }

    // -------------------- UTILIDADES --------------------
    function mostrarMensaje(text, tipo = "info") {
        const className = tipo === "error" ? "mensaje-error" : "mensaje-info";
        contenedor.innerHTML = `<div class="${className}">${text}</div>`;
    }

    function mostrarCargando(text) {
        contenedor.innerHTML = `
            <div class="mensaje-info">
                <div style="font-size: 20px; margin-bottom: 10px;">‚è≥ Cargando...</div>
                <p>${text}</p>
            </div>
        `;
    }

    function mostrarMensajeSinProyectos() {
        contenedor.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">üìÇ</div>
                <h3>No tienes proyectos registrados</h3>
                <p>Parece que a√∫n no tienes proyectos asignados. Contacta al coordinador para que te asigne uno.</p>
                <button class="btn btn-primary" style="margin-top: 20px;" onclick="init()">
                    üîÑ Actualizar
                </button>
            </div>
        `;
    }

    // Inicializar la aplicaci√≥n
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>


</html>
window.seleccionarProyecto = seleccionarProyecto;
